<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extractor de Transcripciones de YouTube Shorts</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 700px;
            margin: auto;
        }
        h1 {
            color: #c00;
            text-align: center;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input[type="url"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #c00;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #a00;
        }
        #resultContainer {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9e9e9;
            border-radius: 4px;
            white-space: pre-wrap; /* Preserve line breaks and spaces */
            word-wrap: break-word;
        }
        .hidden {
            display: none;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        #transcriptText {
            white-space: pre-wrap;  /* Permite el ajuste de línea respetando los saltos de línea originales */
            word-wrap: break-word; /* Fuerza el corte de palabras largas para evitar desbordamiento */
            text-align: justify;   /* Justifica el texto */
            /* Opcional: Si usas <pre>, a veces se añade un margen por defecto. Puedes quitarlo si quieres */
            margin: 0; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Extractor de Transcripciones de YouTube Shorts</h1>
        <form id="transcriptForm">
            <label for="youtubeUrl">URL del YouTube Short:</label>
            <input type="url" id="youtubeUrl" name="youtubeUrl" placeholder="https://www.youtube.com/shorts/xxxxxxxxxxx" required>
            <button type="submit">Extraer Transcripción</button>
        </form>
        <div id="loadingMessage" class="hidden">Procesando... por favor espera.</div>
        <div id="resultContainer" class="hidden">
            <h2>Transcripción:</h2>
            <pre id="transcriptText"></pre>
            <h3>Metadatos:</h3>
            <p id="videoTitle"></p>
            <p id="videoDuration"></p>
            <p id="wordCount"></p>
            <p id="isAutoGenerated"></p>
            <a id="downloadLink" href="#" download="transcripcion.txt" class="hidden">Descargar Transcripción</a>
        </div>
        <div id="errorMessage" class="hidden error"></div>
    </div>

    <script>
        const form = document.getElementById('transcriptForm');
        const resultContainer = document.getElementById('resultContainer');
        const transcriptTextElem = document.getElementById('transcriptText');
        const videoTitleElem = document.getElementById('videoTitle');
        const videoDurationElem = document.getElementById('videoDuration');
        const wordCountElem = document.getElementById('wordCount');
        const isAutoGeneratedElem = document.getElementById('isAutoGenerated');
        const downloadLink = document.getElementById('downloadLink');
        const loadingMessage = document.getElementById('loadingMessage');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const youtubeUrl = document.getElementById('youtubeUrl').value;
            
            resultContainer.classList.add('hidden');
            errorMessage.classList.add('hidden');
            loadingMessage.classList.remove('hidden');
            downloadLink.classList.add('hidden');

            try {
                const response = await fetch('/get_transcript', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ youtube_url: youtubeUrl })
                });

                loadingMessage.classList.add('hidden');
                const data = await response.json();

                if (response.ok) {
                    transcriptTextElem.textContent = data.transcript;
                    videoTitleElem.textContent = `Título: ${data.metadata.title || 'No disponible'}`;
                    videoDurationElem.textContent = `Duración: ${data.metadata.duration || 'No disponible'}`;
                    wordCountElem.textContent = `Conteo de palabras: ${data.metadata.word_count || 'No disponible'}`;
                    isAutoGeneratedElem.textContent = `Generado automáticamente: ${data.metadata.is_auto_generated ? 'Sí' : 'No'}`;
                    
                    // Prepare download link
                    const blob = new Blob([formatOutput(data)], { type: 'text/plain' });
                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = `${data.metadata.title || 'transcripcion'}.txt`;
                    downloadLink.classList.remove('hidden');

                    resultContainer.classList.remove('hidden');
                } else {
                    errorMessage.textContent = `Error: ${data.error || 'Ocurrió un error desconocido.'}`;
                    errorMessage.classList.remove('hidden');
                }
            } catch (error) {
                loadingMessage.classList.add('hidden');
                errorMessage.textContent = `Error de conexión: ${error.message}`;
                errorMessage.classList.remove('hidden');
            }
        });

        function formatOutput(data) {
            let output = `Título: ${data.metadata.title || 'No disponible'}\n`;
            output += `URL: ${document.getElementById('youtubeUrl').value}\n`;
            output += `Duración: ${data.metadata.duration || 'No disponible'}\n`;
            output += `Generado automáticamente: ${data.metadata.is_auto_generated ? 'Sí' : 'No'}\n`;
            output += `Conteo de palabras: ${data.metadata.word_count || 'No disponible'}\n\n`;
            output += `Transcripción:\n------------------------------------\n`;
            output += data.transcript;
            return output;
        }
    </script>
</body>
</html>
